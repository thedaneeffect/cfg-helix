# mise configuration for dotfiles repository
# See: https://mise.jdx.dev/configuration.html

[tools]
# Core languages & runtimes (installed first)
bun = "latest"
go = "latest"
rust = "latest"  # Needed for cargo: packages
zig = "latest"

# CLI utilities
# NOTE: These use aqua backend which hits GitHub API rate limits (60/hour unauthenticated)
# Set GITHUB_TOKEN environment variable for higher limits (5000/hour)
# Or wait an hour if you hit rate limit during testing
bat = "latest"
delta = "latest"
eza = "latest"
fd = "latest"
fzf = "latest"
gh = "latest"
glow = "latest"
jq = "latest"
ripgrep = "latest"
sd = "latest"
starship = "latest"
yq = "latest"
zellij = "latest"
zoxide = "latest"

# Keep in Homebrew (platform issues or needed early):
# btop - not available for macOS arm64 via mise
# dust - kept in Homebrew for simplicity
# grex - kept in Homebrew for simplicity
# gum - needed early for interactive setup
# tokei - asset not found for macOS
# tealdeer (tldr) - not in mise registry

# Development tools
ast-grep = "latest"
helix = "latest"
golangci-lint = "latest"
marksman = "latest"
taplo = "latest"
zls = "latest"

# Go development tools via go: backend
"go:github.com/air-verse/air" = "latest"
"go:github.com/segmentio/golines" = "latest"
"go:mvdan.cc/gofumpt" = "latest"
"go:github.com/nametake/golangci-lint-langserver" = "latest"
"go:golang.org/x/tools/gopls" = "latest"
"go:github.com/go-delve/delve/cmd/dlv" = "latest"
"go:github.com/docker/docker-language-server/cmd/docker-language-server" = "latest"

# Database tools (installed via install_database_tools when INSTALL_TOOLS=true):
# - usql (requires build tags for postgres/sqlite3, not supported by mise go: backend)

[env]
# mise can set environment variables (replaces direnv functionality)
GOPATH = "{{ env.HOME }}/go"
GO111MODULE = "on"

# XDG directories
XDG_CONFIG_HOME = "{{ env.HOME }}/.config"
XDG_DATA_HOME = "{{ env.HOME }}/.local/share"
XDG_CACHE_HOME = "{{ env.HOME }}/.cache"

[tasks.setup]
description = "Run dotfiles setup"
run = "bash ./setup.sh"

[tasks.update-tools]
description = "Update all mise tools and show changes"
run = [
  "mise outdated",
  "mise upgrade --bump",
  "git diff .mise.toml"
]

[tasks.install-fonts]
description = "Install fonts from fonts/ directory"
run = "./scripts/backup-fonts.sh"

[tasks.backup-iterm]
description = "Backup iTerm2 settings (macOS)"
run = "./scripts/backup-iterm.sh"

[settings]
# Automatically install tools when entering directory
auto_install = true

# Experimental features
experimental = true

# Legacy version file support (.nvmrc, .node-version, etc.)
legacy_version_file = true
